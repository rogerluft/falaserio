#!/bin/bash
# Pre-commit hook: Auto-increment versionCode on every commit
# This ensures the build version always reflects code changes

BUILD_FILE="app/build.gradle.kts"

if [ -f "$BUILD_FILE" ]; then
    # Extract current versionCode
    CURRENT_VERSION=$(grep -oP 'versionCode = \K[0-9]+' "$BUILD_FILE")

    if [ -n "$CURRENT_VERSION" ]; then
        NEW_VERSION=$((CURRENT_VERSION + 1))

        # Update versionCode in build.gradle.kts
        sed -i "s/versionCode = $CURRENT_VERSION/versionCode = $NEW_VERSION/" "$BUILD_FILE"

        # Stage the updated file
        git add "$BUILD_FILE"

        echo "Auto-incremented versionCode: $CURRENT_VERSION -> $NEW_VERSION"
    fi
fi

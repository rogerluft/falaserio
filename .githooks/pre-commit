#!/bin/bash
# Pre-commit hook: Auto-increment versionCode on every commit
# This ensures the build version always reflects code changes

BUILD_FILE="app/build.gradle.kts"

if [ -f "$BUILD_FILE" ]; then
    # Extract current versionCode using grep
    CURRENT_VERSION=$(grep "versionCode = " "$BUILD_FILE" | sed 's/[^0-9]//g')

    if [ -n "$CURRENT_VERSION" ]; then
        NEW_VERSION=$((CURRENT_VERSION + 1))

        # Update versionCode in build.gradle.kts (compatible with Windows/MSYS)
        sed -i "s/versionCode = $CURRENT_VERSION/versionCode = $NEW_VERSION/" "$BUILD_FILE"

        # Stage the updated file
        git add "$BUILD_FILE"

        echo "[pre-commit] versionCode: $CURRENT_VERSION -> $NEW_VERSION"
    fi
fi

exit 0
